import requests
import os
import re
import shutil
import ConfigParser

p = ConfigParser.SafeConfigParser()
p.read('{}/conf/yara.conf'.format(os.getcwd()))

class malwareconfigdotcom:
    def __init__(self):
        self.rules = None
        self.x = requests.get(url="https://malwareconfig.com/yara/", verify=False)
        self.rules = re.findall(r"/static/yaraRules/(?P<yarafilename>.*\.yar)\".+", self.x.content)
        self.r = None

    def getyararules(self):
        for rule in self.rules:
            self.r = requests.get(url='https://malwareconfig.com/static/yaraRules/{}'.format(rule), verify=False,
                                  stream=True)
            if self.r.status_code == 200:
                with open('{}/{}'.format(p.get('general', 'yararulesdir'), rule), 'wb') as f:
                    shutil.copyfileobj(self.r.raw, f)
                    f.close()
            del self.r
